!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){(function(t,r){var n="[object Arguments]",o="[object Function]",i="[object GeneratorFunction]",a="[object Map]",s="[object Set]",u=/\w*$/,c=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,h={};h[n]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object DataView]"]=h["[object Boolean]"]=h["[object Date]"]=h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h[a]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h[s]=h["[object String]"]=h["[object Symbol]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Error]"]=h[o]=h["[object WeakMap]"]=!1;var f="object"==typeof t&&t&&t.Object===Object&&t,p="object"==typeof self&&self&&self.Object===Object&&self,v=f||p||Function("return this")(),d=e&&!e.nodeType&&e,y=d&&"object"==typeof r&&r&&!r.nodeType&&r,g=y&&y.exports===d;function m(t,e){return t.set(e[0],e[1]),t}function b(t,e){return t.add(e),t}function _(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function O(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function T(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function j(t,e){return function(r){return t(e(r))}}function k(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var A,x=Array.prototype,w=Function.prototype,D=Object.prototype,S=v["__core-js_shared__"],P=(A=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"",C=w.toString,E=D.hasOwnProperty,B=D.toString,L=RegExp("^"+C.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I=g?v.Buffer:void 0,R=v.Symbol,M=v.Uint8Array,V=j(Object.getPrototypeOf,Object),H=Object.create,U=D.propertyIsEnumerable,F=x.splice,$=Object.getOwnPropertySymbols,W=I?I.isBuffer:void 0,Y=j(Object.keys,Object),N=yt(v,"DataView"),J=yt(v,"Map"),q=yt(v,"Promise"),z=yt(v,"Set"),G=yt(v,"WeakMap"),X=yt(Object,"create"),K=Ot(N),Q=Ot(J),Z=Ot(q),tt=Ot(z),et=Ot(G),rt=R?R.prototype:void 0,nt=rt?rt.valueOf:void 0;function ot(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function it(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function at(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function st(t){this.__data__=new it(t)}function ut(t,e){var r=jt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&kt(t)}(t)&&E.call(t,"callee")&&(!U.call(t,"callee")||B.call(t)==n)}(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],o=r.length,i=!!o;for(var a in t)!e&&!E.call(t,a)||i&&("length"==a||bt(a,o))||r.push(a);return r}function ct(t,e,r){var n=t[e];E.call(t,e)&&Tt(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function lt(t,e){for(var r=t.length;r--;)if(Tt(t[r][0],e))return r;return-1}function ht(t,e,r,c,l,f,p){var v;if(c&&(v=f?c(t,l,f,p):c(t)),void 0!==v)return v;if(!wt(t))return t;var d=jt(t);if(d){if(v=function(t){var e=t.length,r=t.constructor(e);e&&"string"==typeof t[0]&&E.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!e)return function(t,e){var r=-1,n=t.length;e||(e=Array(n));for(;++r<n;)e[r]=t[r];return e}(t,v)}else{var y=mt(t),g=y==o||y==i;if(At(t))return function(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}(t,e);if("[object Object]"==y||y==n||g&&!f){if(O(t))return f?t:{};if(v=function(t){return"function"!=typeof t.constructor||_t(t)?{}:(e=V(t),wt(e)?H(e):{});var e}(g?{}:t),!e)return function(t,e){return vt(t,gt(t),e)}(t,function(t,e){return t&&vt(e,Dt(e),t)}(v,t))}else{if(!h[y])return f?t:{};v=function(t,e,r,n){var o=t.constructor;switch(e){case"[object ArrayBuffer]":return pt(t);case"[object Boolean]":case"[object Date]":return new o(+t);case"[object DataView]":return function(t,e){var r=e?pt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var r=e?pt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}(t,n);case a:return function(t,e,r){return _(e?r(T(t),!0):T(t),m,new t.constructor)}(t,n,r);case"[object Number]":case"[object String]":return new o(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,u.exec(t));return e.lastIndex=t.lastIndex,e}(t);case s:return function(t,e,r){return _(e?r(k(t),!0):k(t),b,new t.constructor)}(t,n,r);case"[object Symbol]":return i=t,nt?Object(nt.call(i)):{}}var i}(t,y,ht,e)}}p||(p=new st);var j=p.get(t);if(j)return j;if(p.set(t,v),!d)var A=r?function(t){return function(t,e,r){var n=e(t);return jt(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,Dt,gt)}(t):Dt(t);return function(t,e){for(var r=-1,n=t?t.length:0;++r<n&&!1!==e(t[r],r,t););}(A||t,(function(n,o){A&&(n=t[o=n]),ct(v,o,ht(n,e,r,c,o,t,p))})),v}function ft(t){return!(!wt(t)||(e=t,P&&P in e))&&(xt(t)||O(t)?L:c).test(Ot(t));var e}function pt(t){var e=new t.constructor(t.byteLength);return new M(e).set(new M(t)),e}function vt(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var a=e[o],s=n?n(r[a],t[a],a,r,t):void 0;ct(r,a,void 0===s?t[a]:s)}return r}function dt(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function yt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return ft(r)?r:void 0}ot.prototype.clear=function(){this.__data__=X?X(null):{}},ot.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},ot.prototype.get=function(t){var e=this.__data__;if(X){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return E.call(e,t)?e[t]:void 0},ot.prototype.has=function(t){var e=this.__data__;return X?void 0!==e[t]:E.call(e,t)},ot.prototype.set=function(t,e){return this.__data__[t]=X&&void 0===e?"__lodash_hash_undefined__":e,this},it.prototype.clear=function(){this.__data__=[]},it.prototype.delete=function(t){var e=this.__data__,r=lt(e,t);return!(r<0)&&(r==e.length-1?e.pop():F.call(e,r,1),!0)},it.prototype.get=function(t){var e=this.__data__,r=lt(e,t);return r<0?void 0:e[r][1]},it.prototype.has=function(t){return lt(this.__data__,t)>-1},it.prototype.set=function(t,e){var r=this.__data__,n=lt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},at.prototype.clear=function(){this.__data__={hash:new ot,map:new(J||it),string:new ot}},at.prototype.delete=function(t){return dt(this,t).delete(t)},at.prototype.get=function(t){return dt(this,t).get(t)},at.prototype.has=function(t){return dt(this,t).has(t)},at.prototype.set=function(t,e){return dt(this,t).set(t,e),this},st.prototype.clear=function(){this.__data__=new it},st.prototype.delete=function(t){return this.__data__.delete(t)},st.prototype.get=function(t){return this.__data__.get(t)},st.prototype.has=function(t){return this.__data__.has(t)},st.prototype.set=function(t,e){var r=this.__data__;if(r instanceof it){var n=r.__data__;if(!J||n.length<199)return n.push([t,e]),this;r=this.__data__=new at(n)}return r.set(t,e),this};var gt=$?j($,Object):function(){return[]},mt=function(t){return B.call(t)};function bt(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||l.test(t))&&t>-1&&t%1==0&&t<e}function _t(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||D)}function Ot(t){if(null!=t){try{return C.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Tt(t,e){return t===e||t!=t&&e!=e}(N&&"[object DataView]"!=mt(new N(new ArrayBuffer(1)))||J&&mt(new J)!=a||q&&"[object Promise]"!=mt(q.resolve())||z&&mt(new z)!=s||G&&"[object WeakMap]"!=mt(new G))&&(mt=function(t){var e=B.call(t),r="[object Object]"==e?t.constructor:void 0,n=r?Ot(r):void 0;if(n)switch(n){case K:return"[object DataView]";case Q:return a;case Z:return"[object Promise]";case tt:return s;case et:return"[object WeakMap]"}return e});var jt=Array.isArray;function kt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!xt(t)}var At=W||function(){return!1};function xt(t){var e=wt(t)?B.call(t):"";return e==o||e==i}function wt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Dt(t){return kt(t)?ut(t):function(t){if(!_t(t))return Y(t);var e=[];for(var r in Object(t))E.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}r.exports=function(t){return ht(t,!0,!0)}}).call(this,r(1),r(2)(t))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";r.r(e);var n={"*compose":"c","+delete":"d","+input":"i",markText:"k",select:"l","*mouse":"m","*rename":"n","+move":"o",paste:"p",drag:"r",setValue:"s",cut:"x",extra:"e"},o=function(t){return n[t]};function i(t){return t.from.line===t.to.line&&t.from.ch===t.to.ch?[t.from.line,t.from.ch]:[[t.from.line,t.from.ch],[t.to.line,t.to.ch]]}function a(t,e){if(t.ops.length!==e.ops.length)return!1;for(var r=0;r<e.ops.length;r++){var n=t.ops[r],o=e.ops[r];if(o.from.line!==o.to.line||n.from.line!==n.to.line||o.from.ch!==o.to.ch||n.from.ch!==n.to.ch)return!1;if(n.from.ch+n.text[0].length!==o.from.ch)return!1}return!0}var s=1200,u=800,c=0,l=0,h=0;function f(t,e){var r=u;return t.delayDuration>=r&&function(t){var e=u/2,r=t.delayDuration;if(0!==l){if(r>=h+e)return!1;if(r<=h-e)return!1}return!0}(e)?(h=(h*l+e.delayDuration)/(l+1),l++,!0):(l=0,h=0,!1)}function p(t,e,r){for(var n=0;n<e.crs.length;n++){var o=t.crs[n],i=e.crs[n];if(o.anchor.line!==o.head.line||o.anchor.ch!==o.head.ch)return!1;if(t.crs[n].anchor.ch+r!==i.anchor.ch)return!1;if(t.crs[n].anchor.line!==i.anchor.line)return!1}return!0}function v(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=u;if(t.crs.length!==e.crs.length)return!1;if(e.delayDuration>=n){if(!f(t,e))return!1}else if(t.delayDuration>=n)return!1;return!!p(t,e,r)}function d(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[];t.length>0;){var n=t.pop();if("crs"in n){for(;t.length>0;){var o=t.pop();if(!("crs"in o)||!v(o,n,e)){t.push(o);break}n.startTime=o.startTime,n.delayDuration=o.delayDuration,n.combo+=1;for(var i=0;i<n.crs.length;i++)n.crs[i].anchor=o.crs[i].anchor}r.unshift(n)}else r.unshift(n)}return r}var y=0,g=0;function m(t,e){var r=s;return t.delayDuration>=r&&function(t){var e=s/2,r=t.delayDuration;if(0!==y){if(r>=g+e)return!1;if(r<=g-e)return!1}return!0}(e)?(g=(g*y+e.delayDuration)/(y+1),y++,!0):(y=0,g=0,!1)}function b(t,e){var r=s;if(t.ops.length!==e.ops.length)return!1;if(e.delayDuration>=r){if(!m(t,e))return!1}else if(t.delayDuration>=r)return!1;return!!function(t,e){for(var r=0;r<e.ops.length;r++){var n=t.ops[r],o=e.ops[r];if(1!==n.text.length)return!1;if(o.from.line!==o.to.line||n.from.line!==n.to.line||o.from.ch!==o.to.ch||n.from.ch!==n.to.ch)return!1;if(n.from.ch+1!==o.from.ch&&(n.from.line+1!==o.from.line||0!==o.from.ch))return!1}return!0}(t,e)}function _(t){for(var e=0;e<t.ops.length;e++){for(var r="",n=0;n<t.ops[e].text.length;n++)""!==t.ops[e].text[n]?r+=t.ops[e].text[n]:n+1<t.ops[e].text.length&&""===t.ops[e].text[n+1]&&(r+="\n");t.ops[e].text=r}return t}function O(t){for(var e=["()","[]","{}","''",'""'],r=0;r<t.ops.length;r++)for(var n=0;n<t.ops[r].text.length;n++)if(e.indexOf(t.ops[r].text[n])>=0)return!0;return!1}var T=r(0),j=r.n(T),k=0,A=0;function x(t,e){var r=u;return t.delayDuration>=r&&function(t){var e=u/2,r=t.delayDuration;if(0!==k){if(r>=A+e)return!1;if(r<=A-e)return!1}return!0}(e)?(A=(A*k+e.delayDuration)/(k+1),k++,!0):(k=0,A=0,!1)}function w(t,e){var r=u;if(t.crs.length!==e.crs.length)return!1;if(e.delayDuration>=r){if(!x(t,e))return!1}else if(t.delayDuration>=r)return!1;return!!function(t,e){for(var r=0;r<e.crs.length;r++){var n=t.crs[r],o=e.crs[r];if(o.anchor.line===o.head.line&&o.anchor.ch===o.head.ch)return!1;if(n.anchor.line!==o.anchor.line||n.anchor.ch!==o.anchor.ch)return!1}return!0}(t,e)}function D(t){for(var e=[],r=-1;t.length>0;){var n=t.shift();r!==n.line&&(e.push([n.line]),r=n.line),e[e.length-1].push(n.ch)}for(var o=0;o<e.length;o++){var i=e[o].slice(1);i=S(i),i=S(i,-1),e[o]=[e[o][0],i]}return e}function S(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[];t.length>0;){var n=t.shift();"number"!=typeof n?r.push(n):0===r.length||Array.isArray(r[r.length-1])?r.push({from:n,to:n}):"to"in r[r.length-1]&&(r[r.length-1].to+e!==n?r.push({from:n,to:n}):r[r.length-1].to=n)}for(var o=0;o<r.length;o++)"to"in r[o]&&(r[o].from===r[o].to?r[o]=r[o].from:r[o]=[r[o].from,r[o].to]);return r}var P=0,C=0;function E(t,e){var r=s;return t.delayDuration>=r&&function(t){var e=s/2,r=t.delayDuration;if(0!==P){if(r>=C+e)return!1;if(r<=C-e)return!1}return!0}(e)?(C=(C*P+e.delayDuration)/(P+1),P++,!0):(P=0,C=0,!1)}function B(t,e){var r=s;if(t.ops.length!==e.ops.length)return!1;if(e.delayDuration>=r){if(!E(t,e))return!1}else if(t.delayDuration>=r)return!1;return!!function(t,e){for(var r=0;r<e.ops.length;r++){var n=t.ops[r],o=e.ops[r];if(n.from.ch!==o.to.ch||n.from.line!==o.to.line)return!1}return!0}(t,e)}function L(t){if(1===t.combo)return t;for(var e=0;e<t.ops.length;e++){for(var r=[],n=[];t.ops[e].removed.length>0;){var o=t.ops[e].removed.shift();"string"==typeof o?0===n.length||n[0].length===o.length?n.push(o):(r.push([n[0].length,n.length]),(n=[]).push(o)):(n.length>0&&(r.push([n[0].length,n.length]),n=[]),r.push([[o[0].line,o[0].ch],[o[1].line,o[1].ch]]))}n.length>0&&r.push([n[0].length,n.length]),t.ops[e].removed=r}return t}var I=function(t){return function(t){for(var e=[];t.length>0;){var r=t.pop();if("*compose"===r.ops[0].origin){for(;t.length>0;){var n=t.pop();if("*compose"!==n.ops[0].origin||!a(n,r)){t.push(n);break}r.startTime=n.startTime,r.delayDuration=n.delayDuration,r.combo+=1;for(var o=0;o<r.ops.length;o++)r.ops[o].from=n.ops[o].from,r.ops[o].to=n.ops[o].to,r.ops[o].text=n.ops[o].text.concat(r.ops[o].text)}e.unshift(r)}else e.unshift(r)}return e}(t)},R=function(t){return t=d(t,1),t=function(t){for(var e=0;e<t.length;e++)if("crs"in t[e]){t[e].ops=[];for(var r=0;r<t[e].crs.length;r++)t[e].ops.push({from:t[e].crs[r].anchor,to:t[e].crs[r].head,origin:"+move",text:[""],removed:[""]});delete t[e].crs}return t}(t=d(t,-1))},M=function(t){return function(t){for(var e=[];t.length>0;){var r=t.pop();if("+input"!==r.ops[0].origin||O(r))e.unshift(r);else{for(;t.length>0;){var n=t.pop();if("+input"!==n.ops[0].origin||O(n)||!b(n,r)){t.push(n);break}r.startTime=n.startTime,r.delayDuration=n.delayDuration,r.combo+=1;for(var o=0;o<r.ops.length;o++)r.ops[o].from=n.ops[o].from,r.ops[o].to=n.ops[o].to,r.ops[o].text=n.ops[o].text.concat(r.ops[o].text)}r=_(r),e.unshift(r)}}return e}(t)},V=function(t){return t=function(t){for(var e=0;e<t.length;e++)if("crs"in t[e]&&t[e].combo>1){t[e].ops=[];for(var r=0;r<t[e].crs.length;r++)t[e].ops.push({from:t[e].crs[r].anchor,to:t[e].crs[r].anchor,origin:"select",text:[""],removed:[""],select:D(t[e].crs[r].heads)});delete t[e].crs}return t}(t=function(t){for(var e=[];t.length>0;){var r=j()(t.pop());if("crs"in r){for(;t.length>0;){var n=j()(t.pop());if(!("crs"in n)||!w(n,r)){t.push(n);break}r.startTime=n.startTime,r.delayDuration=n.delayDuration,r.combo+=1;for(var o=0;o<r.crs.length;o++)"heads"in r.crs[o]?r.crs[o].heads.unshift(n.crs[o].head):r.crs[o].heads=[n.crs[o].head,r.crs[o].head]}e.unshift(r)}else e.unshift(r)}return e}(t))},H=function(t){return function(t){for(var e=[];t.length>0;){var r=t.pop();if("+delete"===r.ops[0].origin){for(;t.length>0;){var n=t.pop();if("+delete"!==n.ops[0].origin||!B(n,r)){t.push(n);break}r.startTime=n.startTime,r.delayDuration=n.delayDuration;for(var o=0;o<r.ops.length;o++)1===r.combo&&r.ops[o].removed.length>1&&(r.ops[o].removed=[[r.ops[o].from,r.ops[o].to]]),n.ops[o].removed.length>1&&(n.ops[o].removed=[[n.ops[o].from,n.ops[o].to]]),r.ops[o].removed=r.ops[o].removed.concat(n.ops[o].removed),r.ops[o].to=n.ops[o].to;r.combo+=1}r=L(r),e.unshift(r)}else e.unshift(r)}return e}(t)};function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var F=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initTime=+new Date,this.lastChangeTime=+new Date,this.lastCursorActivityTime=+new Date,this.operations=[],this.editor=e,this.changesListener=this.changesListener.bind(this),this.cursorActivityListener=this.cursorActivityListener.bind(this),this.swapDocListener=this.swapDocListener.bind(this)}var e,r,n;return e=t,(r=[{key:"recordExtraActivity",value:function(t){var e=[{origin:"extra",activity:t}];this.operations.push({startTime:this.getOperationRelativeTime(),endTime:this.getOperationRelativeTime(),ops:e})}},{key:"listen",value:function(){this.editor.on("changes",this.changesListener),this.editor.on("swapDoc",this.swapDocListener),this.editor.on("cursorActivity",this.cursorActivityListener)}},{key:"getRecords",value:function(){return this.removeRedundantCursorOperations(),this.compressCursorOperations(),this.compressChanges(),JSON.stringify(function(t){for(var e,r=[];t.length>0;){for(var n=t.pop(),a=0;a<n.ops.length;a++)n.ops[a].o=o(n.ops[a].origin),"extra"!==n.ops[a].origin&&(n.ops[a].i=i(n.ops[a]),n.ops[a].a=n.ops[a].text,n.ops[a].d=n.ops[a].removed,1===n.ops[a].a.length&&""===n.ops[a].a[0]&&delete n.ops[a].a,1===n.ops[a].d.length&&""===n.ops[a].d[0]&&delete n.ops[a].d,"select"in n.ops[a]&&(n.ops[a].s=n.ops[a].select,delete n.ops[a].select)),1===n.combo&&delete n.ops[a].d,delete n.ops[a].removed,delete n.ops[a].text,delete n.ops[a].from,delete n.ops[a].origin,delete n.ops[a].to;n.t=(e=[n.startTime,n.endTime])[0]===e[1]?e[0]:e,n.l=n.combo,n.o=n.ops,1===n.l&&delete n.l,delete n.ops,delete n.delayDuration,delete n.combo,delete n.startTime,delete n.endTime,r.unshift(n)}return r}(this.operations))}},{key:"getOperationRelativeTime",value:function(){return+new Date-this.initTime}},{key:"getLastChangePause",value:function(){var t=+new Date,e=t-this.lastChangeTime;return this.lastChangeTime=t,e}},{key:"getLastCursorActivityPause",value:function(){var t=+new Date,e=t-this.lastCursorActivityTime;return this.lastCursorActivityTime=t,e}},{key:"changesListener",value:function(t,e){this.operations.push({startTime:this.getOperationRelativeTime(),endTime:this.getOperationRelativeTime(),delayDuration:this.getLastChangePause(),ops:e,combo:1})}},{key:"swapDocListener",value:function(t,e){var r=[{from:{line:0,ch:0},to:{line:e.lastLine(),ch:e.getLine(e.lastLine()).length},origin:"setValue",removed:e.getValue().split("\n"),text:t.getValue().split("\n")}];this.operations.push({startTime:this.getOperationRelativeTime(),endTime:this.getOperationRelativeTime(),delayDuration:this.getLastChangePause(),ops:r,combo:1})}},{key:"cursorActivityListener",value:function(t){this.operations.push({startTime:this.getOperationRelativeTime(),endTime:this.getOperationRelativeTime(),delayDuration:this.getLastCursorActivityPause(),crs:t.listSelections(),combo:1})}},{key:"isPasteOperation",value:function(t){for(var e=0;e<t.ops.length;e++)if("paste"===t.ops[e].origin)return!0;return!1}},{key:"removeRedundantCursorOperations",value:function(){for(var t=this.operations,e=[],r=0;r<t.length;r++)"ops"in t[r]?(e.push(t[r]),r>0&&this.isPasteOperation(t[r])&&(t[r-1].startTime=t[r].startTime+1,t[r-1].endTime=t[r].endTime+1,e.push(t[r-1]))):r<t.length-1&&"ops"in t[r+1]||e.push(t[r]);this.operations=e}},{key:"compressCursorOperations",value:function(){var t=this.operations;t=V(t),t=R(t),this.operations=t}},{key:"compressChanges",value:function(){var t=this.operations;t=M(t),t=H(t),t=I(t),this.operations=t}}])&&U(e.prototype,r),n&&U(e,n),t}();function $(t){for(var e=[],r=0;r<t.length;r++)for(var n=0;n<t[r][1].length;n++)if("number"==typeof t[r][1][n])e.push([t[r][0],t[r][1][n]]);else{var o=t[r][1][n][0]<t[r][1][n][1]?1:-1,i=t[r][1][n][0];for(e.push([t[r][0],i]);i!==t[r][1][n][1];)i+=o,e.push([t[r][0],i])}return e}var W=function(t,e){var r=t.t[0],n=(t.t[1]-t.t[0])/(t.l-1),o={t:null,o:[],type:"content"};o.t=Math.floor(r+e*n),e===t.l-1&&(o.t=t.t[1]);for(var i=[],a=0;a<t.o.length;a++)i.push(t.o[a].i),o.o.push({a:null,i:null});for(var s=0;s<t.o.length;s++)o.o[s].a=t.o[s].a[e],o.o[s].i=[i[s][0],i[s][1]],i[s][1]+=t.o[s].a[e].length;return o},Y=function(t,e){var r=t.t[0],n=(t.t[1]-t.t[0])/(t.l-1),o={t:null,o:[],type:"cursor"};o.t=Math.floor(r+e*n),e===t.l-1&&(o.t=t.t[1]);for(var i=[],a=0;a<t.o.length;a++)Array.isArray(t.o[a].i[0])||(t.o[a].i=[t.o[a].i,t.o[a].i]),i.push(t.o[a].i),o.o.push({i:null});for(var s=0;s<t.o.length;s++){var u=i[s][0][0],c=i[s][0][1]+(i[s][1][1]-i[s][0][1])/(t.l-1)*e;o.o[s].i=[u,c]}return o},N=function(t,e){var r=t.t[0],n=(t.t[1]-t.t[0])/(t.l-1),o={t:null,o:[],type:"content"};o.t=Math.floor(r+e*n),e===t.l-1&&(o.t=t.t[1]);for(var i=[],a=0;a<t.o.length;a++)i.push(t.o[a].i),o.o.push({a:null,i:null});for(var s=0;s<t.o.length;s++)o.o[s].a=t.o[s].a[e],o.o[s].i=[i[s][0],i[s][1]],"\n"!==o.o[s].a?i[s][1]++:(i[s][0]++,i[s][1]=0);return o},J=function(t,e){var r=t.t[0],n=(t.t[1]-t.t[0])/(t.l-1),o={t:null,o:[],type:"cursor"};o.t=Math.floor(r+e*n),e===t.l-1&&(o.t=t.t[1]);for(var i=[],a=0;a<t.o.length;a++)i.push(t.o[a].i),o.o.push({i:null});for(var s=0;s<t.o.length;s++){var u=[t.o[s].i[0],t.o[s].i[1]],c=$(t.o[s].s),l=[c[e][0],c[e][1]];o.o[s].i=[u,l]}return o},q=function(t,e){var r=t.t[0],n=(t.t[1]-t.t[0])/(t.l-1),o={t:null,o:[],type:"content"};o.t=Math.floor(r+e*n),e===t.l-1&&(o.t=t.t[1]);for(var i=[],a=0;a<t.o.length;a++)i.push(t.o[a].i[1]),o.o.push({i:null});for(var s=0;s<t.o.length;s++){var u=t.o[s].d.pop();"number"==typeof u[0]?(o.o[s].i=[[i[s][0],i[s][1]-u[0]],[i[s][0],i[s][1]]],i[s][1]-=u[0],u[1]-1>0&&t.o[s].d.push([u[0],u[1]-1])):(o.o[s].i=[[u[0][0],u[0][1]],[u[1][0],u[1][1]]],t.o[s].i[1]=[u[0][0],u[0][1]])}return o};function z(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return G(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function X(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var K=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.operations=[],this.playedOperations=[],this.editor=e,this.cachedValue=null,this.status="PAUSE",this.timer=null,this.currentOperation=null,this.duration=0,this.lastOperationTime=0,this.lastPlayTime=0,this.seekTime=null,this.playedTimeBeforeOperation=0,this.playedTimeBeforePause=0,this.speedBeforeSeeking=null,r&&(this.maxDelay=r.maxDelay||c,this.autoplay=r.autoplay||!1,this.speed=r.speed||1,this.extraActivityHandler=r.extraActivityHandler||null,this.extraActivityReverter=r.extraActivityReverter||null,this.onEndedHandler=r.onEndedHandler||null)}var e,r,n;return e=t,(r=[{key:"setOption",value:function(t){var e=this.status;"PLAY"===e&&this.pause(),t(),"PLAY"===e&&this.play()}},{key:"setMaxDelay",value:function(t){var e=this;this.setOption((function(){t&&(e.maxDelay=t)}))}},{key:"setAutoplay",value:function(t){var e=this;this.setOption((function(){t&&(e.autoplay=t)}))}},{key:"setSpeed",value:function(t){var e=this;this.setOption((function(){t&&(e.speed=t)}))}},{key:"setExtraActivityHandler",value:function(t){var e=this;this.setOption((function(){t&&(e.extraActivityHandler=t)}))}},{key:"setExtraActivityReverter",value:function(t){var e=this;this.setOption((function(){t&&(e.extraActivityReverter=t)}))}},{key:"setOnEndedHandler",value:function(t){var e=this;this.setOption((function(){t&&(e.onEndedHandler=t)}))}},{key:"addOperations",value:function(t){var e=this.parseOperations(t);this.operations=this.operations.concat(e),this.duration=e[e.length-1].t,this.autoplay&&this.play()}},{key:"isAutoIndent",value:function(t){return"i"===t.o&&""===t.a}},{key:"play",value:function(){"PLAY"!==this.status&&(this.editor.focus(),this.playChanges())}},{key:"pause",value:function(){"PAUSE"!==this.status&&(this.status="PAUSE",this.playedTimeBeforePause=((new Date).getTime()-this.lastPlayTime)*this.speed,this.playedTimeBeforeOperation+=this.playedTimeBeforePause,null!==this.currentOperation&&(clearTimeout(this.timer),this.currentOperation=null))}},{key:"getStatus",value:function(){return this.status}},{key:"getCurrentTime",value:function(){var t=this.lastOperationTime+this.playedTimeBeforeOperation;return"PLAY"===this.status?t+((new Date).getTime()-this.lastPlayTime)*this.speed:t}},{key:"getDuration",value:function(){return this.duration}},{key:"seek",value:function(t){this.speedBeforeSeeking=this.speed,this.statusBeforeSeeking=this.status,this.speed=0,this.seekTime=t,this.editor.focus(),this.pause(),this.lastOperationTime<this.seekTime?this.playChanges():this.lastOperationTime>this.seekTime&&this.revertChanges()}},{key:"stopSeek",value:function(){this.pause(),this.seekTime&&(this.playedTimeBeforeOperation=this.seekTime-this.lastOperationTime,null!==this.speedBeforeSeeking&&this.setSpeed(this.speedBeforeSeeking),this.seekTime=null,"PLAY"===this.statusBeforeSeeking&&this.play())}},{key:"playChanges",value:function(){var t=this;this.lastPlayTime=(new Date).getTime();var e=this.operations;if(e.length>0){this.status="PLAY",this.currentOperation=e[0];var r=this.currentOperation,n=this.getOperationDelay(r);if(this.seekTime&&r.t>this.seekTime)return void this.stopSeek();this.timer=setTimeout((function(){t.lastOperationTime=r.t,t.operations.shift(),t.playChange(t.editor,r),0===t.operations.length&&(t.currentOperation=null,t.stopSeek(),t.onEndedHandler&&t.onEndedHandler())}),0===this.speed?0:n/this.speed)}}},{key:"getOperationDelay",value:function(t){var e=t.t-this.lastOperationTime-this.playedTimeBeforeOperation;return e>this.maxDelay&&this.maxDelay>0?this.maxDelay:e}},{key:"playChange",value:function(t,e){this.playedTimeBeforeOperation=0;var r=t.getValue();null!==this.cachedValue&&this.cachedValue===r||(this.cachedValue=r,e.revertValue=r);for(var n=0;n<e.o.length&&!this.playExtraActivity(e);n++){var o=this.insertionText(e.o[n]),i=e.o[n].i;"number"==typeof i[0]&&(i=[i,i]),this.isAutoIndent(e.o[n])||"\n\n"!==e.o[0].a&&(0===n?t.setSelection({line:i[0][0],ch:i[0][1]},{line:i[1][0],ch:i[1][1]}):t.addSelection({line:i[0][0],ch:i[0][1]},{line:i[1][0],ch:i[1][1]})),"content"===e.type&&t.replaceRange(o,{line:i[0][0],ch:i[0][1]},{line:i[1][0],ch:i[1][1]})}this.playedOperations.unshift(e),this.playChanges()}},{key:"playExtraActivity",value:function(t){return"extra"===t.type&&(this.extraActivityHandler?this.extraActivityHandler(t.o[0].activity):console.warn("extraActivityHandler is required in player"),!0)}},{key:"insertionText",value:function(t){var e="";return"string"==typeof t.a?e=t.a:"a"in t&&(e=t.a.join("\n")),e}},{key:"revertChanges",value:function(){var t=this.playedOperations;if(!(t.length>0))return this.lastOperationTime=0,void this.stopSeek();this.currentOperation=t[0],this.revertChange(this.editor,this.currentOperation)}},{key:"revertChange",value:function(t,e){this.lastOperationTime=e.t,this.seekTime&&this.lastOperationTime<=this.seekTime?this.stopSeek():(void 0!==e.revertValue&&t.setValue(e.revertValue),this.revertExtraActivity(e),this.playedOperations.shift(),this.operations.unshift(e),this.revertChanges())}},{key:"revertExtraActivity",value:function(t){return"extra"===t.type&&(this.extraActivityReverter?this.extraActivityReverter(t.o[0].activity):console.warn("extraActivityReverter is required in player"),!0)}},{key:"classifyOperation",value:function(t){return t.type="content","o"===t.o[0].o||"l"===t.o[0].o?t.type="cursor":"e"===t.o[0].o&&(t.type="extra"),t}},{key:"parseOperations",value:function(t){var e,r=[],n=z(t=JSON.parse(t));try{for(n.s();!(e=n.n()).done;){var o=e.value;if("l"in(o=this.classifyOperation(o)))for(var i=0;i<o.l;i++)"i"===o.o[0].o?r.push(N(o,i)):"c"===o.o[0].o?r.push(W(o,i)):"d"===o.o[0].o?r.push(q(o,i)):"o"===o.o[0].o?r.push(Y(o,i)):"l"===o.o[0].o&&r.push(J(o,i));else r.push(o)}}catch(t){n.e(t)}finally{n.f()}return r}}])&&X(e.prototype,r),n&&X(e,n),t}(),Q=CodeMirror.fromTextArea(document.getElementById("editor-record"),{mode:"javascript",autoCloseBrackets:!0}),Z=new F(Q),tt="";Z.listen(),document.getElementById("get-records").onclick=function(){tt=Z.getRecords(),console.log(JSON.parse(tt))},document.getElementById("add-operations").onclick=function(){""!==tt?(console.log("operations added"),ot.addOperations(tt),tt=""):console.log("no operation to be added")},document.getElementById("play").onclick=function(){console.log("start playing"),ot.play()},document.getElementById("pause").onclick=function(){console.log("pause playing"),ot.pause()},document.getElementById("speed").onchange=function(){var t=document.getElementById("speed").value;console.log("change speed to",t),ot.setSpeed(t)};var et=document.getElementById("progress-bar"),rt=document.getElementById("progress-bar-slider"),nt=et.offsetWidth;setInterval((function(){var t=ot.getCurrentTime(),e=ot.getDuration(),r=nt*(t/e);t>=0&&(rt.style.left=r+"px")}),100),et.onclick=function(t){var e=t.offsetX,r=e/nt*ot.getDuration();rt.style.left=e+"px",console.log("seek to: ",r),ot.seek(r)};var ot=new K(CodeMirror.fromTextArea(document.getElementById("editor-play"),{readOnly:!0,mode:"javascript",autoCloseBrackets:!0}),{maxPause:3e3,extraActivityHandler:function(t){console.log(t)}});Q.setValue("// This is a demo.\n// Write you code here:")}]);